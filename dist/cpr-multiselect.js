/*!
 * cpr-multiselect
 * author: Bret Little
 * copyright: 2015
 * license: MIT
 * version: 2.2.9
 */
!function(e){function t(i){if(s[i])return s[i].exports;var l=s[i]={exports:{},id:i,loaded:!1};return e[i].call(l.exports,l,l.exports,t),l.loaded=!0,l.exports}var s={};return t.m=e,t.c=s,t.p="",t(0)}([function(e,t,s){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function l(e){var t=e.item,s=e.selectedItems,i=(0,o.includes)(s,t);return a["default"].createElement("div",{title:""+t.label},a["default"].createElement("div",{className:"cp-multi-selector-item__icon "+(i?"cps-bg-primary-green +selected":"")},a["default"].createElement("i",{className:"cps-icon cps-icon-lg-check",style:{opacity:i?"1":"0"}})),a["default"].createElement("div",{className:"cp-multi-selector-item__title"},""+t.label))}function n(e,t){for(var s,i=!0;i;){var l=e,n=t;if(i=!1,!l)return!1;if(s=l.className.indexOf(n)>-1)return s;e=l.parentElement,t=n,i=!0}}Object.defineProperty(t,"__esModule",{value:!0});var c=s(1),a=i(c),o=s(2),r=a["default"].createClass({displayName:"MultiSelector",componentWillMount:function(){document.addEventListener("click",this.state.close)},componentWillUnmount:function(){document.removeEventListener("click",this.state.close)},getInitialState:function(){var e=this;return{selectedItems:this.props.initialSelectedItems||[],mouseIndex:null,mouseActive:!0,mouseFunc:null,dialogDisplayed:!1,activeIndex:null,searchValue:"",close:function(t){n(t.target,"cp-multi-selector")||e.setState({dialogDisplayed:!1})}}},componentWillReceiveProps:function(e){this.setState({selectedItems:e.initialSelectedItems||[]})},displayDialog:function(e){this.setState({dialogDisplayed:!0})},removeItem:function(e,t){this.setState({selectedItems:(0,o.without)(this.state.selectedItems,e)}),setTimeout(this.triggerItemChange)},getItemTitle:function(e){return e.label},setActiveIndex:function(e){var t=this;this.setState({activeIndex:e,mouseIndex:null},function(){t.searchItems[t.state.activeIndex].scrollIntoView(),t.state.mouseActive&&t.setState({mouseActive:!1,mouseFunc:function(){t.setState({mouseActive:!0}),document.removeEventListener("mousemove",t.state.mouseFunc)}},function(){document.addEventListener("mousemove",t.state.mouseFunc)})})},keyDown:function(e){var t=e.which,s=this.state.activeIndex,i=this.getFilterItems(this.props.items);if(this.props.onInputChange&&this.props.onInputChange(e.currentTarget.value),13===t&&e.preventDefault(),40===t){if((0,o.isNull)(s))return this.setActiveIndex(0);if(s<i.length-1)return this.setActiveIndex(s+1)}else if(38===t){if(!s)return this.setActiveIndex(0);if(s>0)return this.setActiveIndex(s-1)}else if(13===t){if(!(0,o.isNull)(s))return this.selectItem(i[s]);this.props.noRestrict&&(this.selectItem(e.currentTarget.value),e.currentTarget.value="")}else if(27===t)return this.setState({activeIndex:null,dialogDisplayed:!1});this.setState({searchValue:e.target.value})},triggerItemChange:function(){this.props.onChange&&this.props.onChange.call(null,this.state.selectedItems)},getSelectedClass:function(e){return(0,o.includes)(this.state.selectedItems,e)?"+selected":""},getActiveClass:function(e){return this.state.activeIndex===e||this.state.mouseIndex===e?"+highlighted":""},getFilterItems:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],s=this.props.getItemTitle||this.getItemTitle;return t.filter(function(t){return s(t).toLowerCase().indexOf(e.state.searchValue.toLowerCase())>-1})},getSearchItems:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],s=this.props.ItemComponent||l;return this.getFilterItems(t).map(function(t,i){return a["default"].createElement("div",{key:i,ref:function(t){e.searchItems?e.searchItems[i]=t:(e.searchItems=[],e.searchItems[i]=t)},onMouseOver:function(){e.state.mouseActive&&e.setState({mouseIndex:i})},className:"cp-multi-selector-item "+e.getSelectedClass(t)+" "+e.getActiveClass(i),onClick:e.selectItem.bind(e,t)},a["default"].createElement(s,{item:t,selectedItems:e.state.selectedItems}))})},selectItem:function(e,t){var s=this.state.selectedItems;(0,o.includes)(s,e)?this.setState({selectedItems:(0,o.without)(s,e)}):this.setState({selectedItems:(0,o.union)(s,[e])}),setTimeout(this.triggerItemChange)},positionDialog:function(){var e=this;setTimeout(function(){var t=e.el,s=t.clientHeight,i=t.querySelector(".cp-multi-selector__dialog");i&&(i.style.top=s+1+"px"),t.querySelector(".cp-multi-selector__dialog__input").focus()},100)},prevent:function(e){13===e.which&&e.preventDefault()},render:function(){var e=this,t=this.props.getItemTitle||this.getItemTitle,s=this.state.selectedItems.map(function(s,i){return a["default"].createElement("div",{key:i,className:"cp-multi-selector__pill",title:""+t(s)},a["default"].createElement("span",{style:{verticalAlign:"top",margin:"0 8px"},tooltip:t(s)},t(s)),a["default"].createElement("div",{className:"cp-multi-selector__pill__close"},a["default"].createElement("i",{onClick:e.removeItem.bind(e,s),className:"cps-icon cps-icon-close"})))}),i=void 0,l=this;if(this.state.dialogDisplayed){var n=this.props.placeholder?this.props.placeholder:"Type a collaborators name...";i=a["default"].createElement("div",{className:"cp-multi-selector__dialog depth-z2",style:{}},a["default"].createElement("div",{style:{padding:"16px",borderBottom:"1px solid #E9E9E9"}},a["default"].createElement("input",{onKeyDown:this.keyDown,className:"cps-form-control cp-multi-selector__dialog__input",placeholder:n})),a["default"].createElement("div",{className:"cp-multi-selector__dialog__items"},this.getSearchItems(this.props.items))),this.positionDialog()}return a["default"].createElement("div",{ref:function(e){e&&(l.el=e)},className:"cp-multi-selector"},a["default"].createElement("input",{type:"input",className:"cp-multi-selector__hidden-input",onFocus:this.displayDialog}),a["default"].createElement("div",{onClick:this.displayDialog,className:"cp-multi-selector__main-input cps-form-control"},s),i)}});window&&!window.MultiSelector&&(window.MultiSelector=r),t["default"]=r,e.exports=t["default"]},function(e,t){e.exports=React},function(e,t){e.exports=_}]);