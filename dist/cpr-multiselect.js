/*!
 * cpr-multiselect
 * author: Bret Little
 * copyright: 2015
 * license: MIT
 * version: 2.0.1
 */
!function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return e[s].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function s(e,t){for(var i,s=!0;s;){s=!1;var n=e,l=t;if(!n)return!1;if(i=n.className.indexOf(l)>-1)return i;e=n.parentElement,t=l,s=!0}}var n=function(e){return e&&e.__esModule?e["default"]:e},l=n(i(1)),a=i(2),r=a.without,c=a.contains,o=a.union,m=a.isNull,u=l.createClass({displayName:"DefaultItemComponent",render:function(){var e=this.props.item.firstName,t=this.props.item.lastName;return l.createElement("div",null,l.createElement("div",{className:"cp-multi-selector-item__icon cps-bg-medium-gray cps-gray-5"},""+e[0]+t[0]),l.createElement("div",{className:"cp-multi-selector-item__title"},""+e+" "+t),l.createElement("div",{className:"cp-multi-selector-item__check"},l.createElement("i",{className:"cps-icon cps-icon-lg-check cps-info"})))}}),p=l.createClass({displayName:"MultiSelector",componentWillMount:function(){document.body.addEventListener("click",this.state.close)},componentWillUnmount:function(){document.body.removeEventListener("click",this.state.close)},getInitialState:function(){var e=this;return{selectedItems:this.props.initialSelectedItems||[],dialogDisplayed:!1,activeIndex:null,searchValue:"",close:function(t){s(t.target,"cp-multi-selector")||e.setState({dialogDisplayed:!1})}}},displayDialog:function(e){this.setState({dialogDisplayed:!0})},removeItem:function(e,t){this.setState({selectedItems:r(this.state.selectedItems,e)}),setTimeout(this.triggerItemChange)},getItemTitle:function(e){return""+e.firstName+" "+e.lastName},keyUp:function(e){var t=e.which,i=this.state.activeIndex,s=this.getFilterItems(this.props.items);if(40===t){if(m(i))return this.setState({activeIndex:0});if(i<s.length-1)return this.setState({activeIndex:i+1})}else if(38===t){if(!i)return this.setState({activeIndex:0});if(i>0)return this.setState({activeIndex:i-1})}else if(13===t){if(!m(i))return this.selectItem(s[i]);this.props.noRestrict&&(this.selectItem(e.currentTarget.value),e.currentTarget.value="")}else if(27===t)return this.setState({activeIndex:null,dialogDisplayed:!1});this.setState({searchValue:e.target.value})},triggerItemChange:function(){this.props.onChange&&this.props.onChange.call(null,this.state.selectedItems)},getSelectedClass:function(e){return c(this.state.selectedItems,e)?"+selected":""},getActiveClass:function(e){return this.state.activeIndex===e?"+highlighted":""},getFilterItems:function(){var e=this,t=void 0===arguments[0]?[]:arguments[0],i=this.props.getItemTitle||this.getItemTitle;return t.filter(function(t){return i(t).toLowerCase().indexOf(e.state.searchValue.toLowerCase())>-1}).filter(function(e,t){return 4>t})},getSearchItems:function(){var e=this,t=void 0===arguments[0]?[]:arguments[0],i=this.props.ItemComponent||u;return this.getFilterItems(t).map(function(t,s){return l.createElement("div",{key:s,className:"cp-multi-selector-item "+e.getSelectedClass(t)+" "+e.getActiveClass(s),onClick:e.selectItem.bind(e,t)},l.createElement(i,{item:t}))})},selectItem:function(e,t){var i=this.state.selectedItems;c(i,e)?this.setState({selectedItems:r(i,e)}):this.setState({selectedItems:o(i,[e])}),setTimeout(this.triggerItemChange)},positionDialog:function(){var e=this;setTimeout(function(){var t=l.findDOMNode(e),i=t.clientHeight,s=t.querySelector(".cp-multi-selector__dialog");s.style.top=i+1+"px",t.querySelector(".cp-multi-selector__dialog__input").focus()},100)},prevent:function(e){13===e.which&&e.preventDefault()},render:function(){var e=this,t=this.props.getItemTitle||this.getItemTitle,i=this.state.selectedItems.map(function(i,s){return l.createElement("div",{key:s,className:"cp-multi-selector__pill cps-white cps-bg-gray-10"},l.createElement("span",{style:{verticalAlign:"top"}},t(i)),l.createElement("i",{onClick:e.removeItem.bind(e,i),className:"cps-icon cps-icon-sm-close"}))}),s=void 0;if(this.state.dialogDisplayed){var n=this.props.placeholder?this.props.placeholder:"Type a collaborators name...";s=l.createElement("div",{className:"cp-multi-selector__dialog depth-z2",style:{}},l.createElement("input",{onKeyUp:this.keyUp,className:"cps-form-control cp-multi-selector__dialog__input",placeholder:n,onKeyDown:this.prevent}),l.createElement("div",{className:"cp-multi-selector__dialog__items"},this.getSearchItems(this.props.items))),this.positionDialog()}return l.createElement("div",{className:"cp-multi-selector"},l.createElement("input",{type:"input",className:"cp-multi-selector__hidden-input",onFocus:this.displayDialog}),l.createElement("div",{onClick:this.displayDialog,className:"cp-multi-selector__main-input cps-form-control"},i),s)}});window&&!window.MultiSelector&&(window.MultiSelector=p),e.exports=p},function(e,t,i){e.exports=React},function(e,t,i){e.exports=_}]);