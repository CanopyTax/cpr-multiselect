/*!
 * cpr-multiselect
 * author: Bret Little
 * copyright: 2015
 * license: MIT
 * version: 1.1.0
 */
!function(e){function t(s){if(i[s])return i[s].exports;var l=i[s]={exports:{},id:s,loaded:!1};return e[s].call(l.exports,l,l.exports,t),l.loaded=!0,l.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function s(e,t){for(var i,s=!0;s;){s=!1;var l=e,n=t;if(!l)return!1;if(i=l.className.indexOf(n)>-1)return i;e=l.parentElement,t=n,s=!0}}var l=function(e){return e&&e.__esModule?e["default"]:e},n=l(i(1)),a=i(2),c=a.without,r=a.contains,o=a.union,m=a.isNull,u=n.createClass({displayName:"DefaultItemComponent",render:function(){var e=this.props.item.firstName,t=this.props.item.lastName;return n.createElement("div",null,n.createElement("div",{className:"cp-multi-selector-item__icon cps-bg-medium-gray cps-gray-5"},""+e[0]+t[0]),n.createElement("div",{className:"cp-multi-selector-item__title"},""+e+" "+t),n.createElement("div",{className:"cp-multi-selector-item__check"},n.createElement("i",{className:"cps-icon cps-icon-lg-check cps-info"})))}}),p=n.createClass({displayName:"MultiSelector",componentWillMount:function(){document.body.addEventListener("click",this.state.close)},componentWillUnmount:function(){document.body.removeEventListener("click",this.state.close)},getInitialState:function(){var e=this;return{selectedItems:this.props.initialSelectedItems||[],dialogDisplayed:!1,activeIndex:null,searchValue:"",close:function(t){s(t.target,"cp-multi-selector")||e.setState({dialogDisplayed:!1})}}},displayDialog:function(e){this.setState({dialogDisplayed:!0})},removeItem:function(e,t){this.setState({selectedItems:c(this.state.selectedItems,e)}),setTimeout(this.triggerItemChange)},getItemTitle:function(e){return""+e.firstName+" "+e.lastName},keyUp:function(e){var t=e.which,i=this.state.activeIndex,s=this.getFilterItems(this.props.items);if(40===t){if(m(i))return this.setState({activeIndex:0});if(i<s.length-1)return this.setState({activeIndex:i+1})}else if(38===t){if(!i)return this.setState({activeIndex:0});if(i>0)return this.setState({activeIndex:i-1})}else if(13===t){if(!m(i))return this.selectItem(s[i])}else if(27===t)return this.setState({activeIndex:null,dialogDisplayed:!1});this.setState({searchValue:e.target.value})},triggerItemChange:function(){this.props.onChange&&this.props.onChange.call(null,this.state.selectedItems)},getSelectedClass:function(e){return r(this.state.selectedItems,e)?"+selected":""},getActiveClass:function(e){return this.state.activeIndex===e?"+highlighted":""},getFilterItems:function(){var e=this,t=void 0===arguments[0]?[]:arguments[0],i=this.props.getItemTitle||this.getItemTitle;return t.filter(function(t){return i(t).toLowerCase().indexOf(e.state.searchValue.toLowerCase())>-1}).filter(function(e,t){return 4>t})},getSearchItems:function(){var e=this,t=void 0===arguments[0]?[]:arguments[0],i=this.props.ItemComponent||u;return this.getFilterItems(t).map(function(t,s){return n.createElement("div",{className:"cp-multi-selector-item "+e.getSelectedClass(t)+" "+e.getActiveClass(s),onClick:e.selectItem.bind(e,t)},n.createElement(i,{item:t}))})},selectItem:function(e,t){var i=this.state.selectedItems;r(i,e)?this.setState({selectedItems:c(i,e)}):this.setState({selectedItems:o(i,[e])}),setTimeout(this.triggerItemChange)},positionDialog:function(){var e=this;setTimeout(function(){var t=n.findDOMNode(e),i=t.clientHeight,s=t.querySelector(".cp-multi-selector__dialog");s.style.top=i+1+"px",t.querySelector(".cp-multi-selector__dialog__input").focus()},100)},render:function(){var e=this,t=this.props.getItemTitle||this.getItemTitle,i=this.state.selectedItems.map(function(i){return n.createElement("div",{className:"cp-multi-selector__pill cps-white cps-bg-gray-10"},n.createElement("span",{style:{verticalAlign:"top"}},t(i)),n.createElement("i",{onClick:e.removeItem.bind(e,i),className:"cps-icon cps-icon-sm-close"}))}),s=void 0;return this.state.dialogDisplayed&&(s=n.createElement("div",{className:"cp-multi-selector__dialog depth-z2",style:{}},n.createElement("input",{onKeyUp:this.keyUp,className:"cps-form-control cp-multi-selector__dialog__input",placeholder:"Type a collaborators name..."}),n.createElement("div",{className:"cp-multi-selector__dialog__items"},this.getSearchItems(this.props.items))),this.positionDialog()),n.createElement("div",{className:"cp-multi-selector"},n.createElement("input",{type:"input",className:"cp-multi-selector__hidden-input",onFocus:this.displayDialog}),n.createElement("div",{onClick:this.displayDialog,className:"cp-multi-selector__main-input cps-form-control"},i),s)}});window.MultiSelector||(window.MultiSelector=p),e.exports=p},function(e,t){e.exports=React},function(e,t){e.exports=_}]);