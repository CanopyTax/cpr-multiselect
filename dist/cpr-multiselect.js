/*!
 * cpr-multiselect
 * author: Bret Little
 * copyright: 2015
 * license: MIT
 * version: 2.1.0
 */
!function(e){function t(i){if(s[i])return s[i].exports;var n=s[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var s={};return t.m=e,t.c=s,t.p="",t(0)}([function(e,t,s){"use strict";function i(e){var t=e.item,s=e.selectedItems,i=a(s,t);return c.createElement("div",{title:""+t.label},c.createElement("div",{className:"cp-multi-selector-item__icon "+(i?"cps-bg-primary-green +selected":"")},i?c.createElement("i",{className:"cps-icon cps-icon-lg-check"}):null),c.createElement("div",{className:"cp-multi-selector-item__title"},""+t.label))}function n(e,t){for(var s,i=!0;i;){i=!1;var n=e,l=t;if(!n)return!1;if(s=n.className.indexOf(l)>-1)return s;e=n.parentElement,t=l,i=!0}}var l=function(e){return e&&e.__esModule?e["default"]:e},c=l(s(1)),o=s(2),r=o.without,a=o.includes,u=o.union,m=o.isNull,p=c.createClass({displayName:"MultiSelector",componentWillMount:function(){document.addEventListener("click",this.state.close)},componentWillUnmount:function(){document.removeEventListener("click",this.state.close)},getInitialState:function(){var e=this;return{selectedItems:this.props.initialSelectedItems||[],mouseIndex:null,mouseActive:!0,mouseFunc:null,dialogDisplayed:!1,activeIndex:null,searchValue:"",close:function(t){n(t.target,"cp-multi-selector")||e.setState({dialogDisplayed:!1})}}},displayDialog:function(e){this.setState({dialogDisplayed:!0})},removeItem:function(e,t){this.setState({selectedItems:r(this.state.selectedItems,e)}),setTimeout(this.triggerItemChange)},getItemTitle:function(e){return e.label},setActiveIndex:function(e){var t=this;this.setState({activeIndex:e,mouseIndex:null},function(){t.searchItems[t.state.activeIndex].scrollIntoView(),t.state.mouseActive&&t.setState({mouseActive:!1,mouseFunc:function(){t.setState({mouseActive:!0}),document.removeEventListener("mousemove",t.state.mouseFunc)}},function(){document.addEventListener("mousemove",t.state.mouseFunc)})})},keyDown:function(e){var t=e.which,s=this.state.activeIndex,i=this.getFilterItems(this.props.items);if(this.props.onInputChange&&this.props.onInputChange(e.currentTarget.value),13===t&&e.preventDefault(),40===t){if(m(s))return this.setActiveIndex(0);if(s<i.length-1)return this.setActiveIndex(s+1)}else if(38===t){if(!s)return this.setActiveIndex(0);if(s>0)return this.setActiveIndex(s-1)}else if(13===t){if(!m(s))return this.selectItem(i[s]);this.props.noRestrict&&(this.selectItem(e.currentTarget.value),e.currentTarget.value="")}else if(27===t)return this.setState({activeIndex:null,dialogDisplayed:!1});this.setState({searchValue:e.target.value})},triggerItemChange:function(){this.props.onChange&&this.props.onChange.call(null,this.state.selectedItems)},getSelectedClass:function(e){return a(this.state.selectedItems,e)?"+selected":""},getActiveClass:function(e){return this.state.activeIndex===e||this.state.mouseIndex===e?"+highlighted":""},getFilterItems:function(){var e=this,t=void 0===arguments[0]?[]:arguments[0],s=this.props.getItemTitle||this.getItemTitle;return t.filter(function(t){return s(t).toLowerCase().indexOf(e.state.searchValue.toLowerCase())>-1})},getSearchItems:function(){var e=this,t=void 0===arguments[0]?[]:arguments[0],s=this.props.ItemComponent||i;return this.getFilterItems(t).map(function(t,i){return c.createElement("div",{key:i,ref:function(t){e.searchItems?e.searchItems[i]=t:(e.searchItems=[],e.searchItems[i]=t)},onMouseOver:function(){e.state.mouseActive&&e.setState({mouseIndex:i})},className:"cp-multi-selector-item "+e.getSelectedClass(t)+" "+e.getActiveClass(i),onClick:e.selectItem.bind(e,t)},c.createElement(s,{item:t,selectedItems:e.state.selectedItems}))})},selectItem:function(e,t){var s=this.state.selectedItems;a(s,e)?this.setState({selectedItems:r(s,e)}):this.setState({selectedItems:u(s,[e])}),setTimeout(this.triggerItemChange)},positionDialog:function(){var e=this;setTimeout(function(){var t=e.el,s=t.clientHeight,i=t.querySelector(".cp-multi-selector__dialog");i.style.top=s+1+"px",t.querySelector(".cp-multi-selector__dialog__input").focus()},100)},prevent:function(e){13===e.which&&e.preventDefault()},render:function(){var e=this,t=this.props.getItemTitle||this.getItemTitle,s=this.state.selectedItems.map(function(s,i){return c.createElement("div",{key:i,className:"cp-multi-selector__pill",title:""+t(s)},c.createElement("span",{style:{verticalAlign:"top",margin:"0 8px"},tooltip:t(s)},t(s)),c.createElement("div",{className:"cp-multi-selector__pill__close"},c.createElement("i",{onClick:e.removeItem.bind(e,s),className:"cps-icon cps-icon-close"})))}),i=void 0,n=this;if(this.state.dialogDisplayed){var l=this.props.placeholder?this.props.placeholder:"Type a collaborators name...";i=c.createElement("div",{className:"cp-multi-selector__dialog depth-z2",style:{}},c.createElement("div",{style:{padding:"16px",borderBottom:"1px solid #E9E9E9"}},c.createElement("input",{onKeyDown:this.keyDown,className:"cps-form-control cp-multi-selector__dialog__input",placeholder:l})),c.createElement("div",{className:"cp-multi-selector__dialog__items"},this.getSearchItems(this.props.items))),this.positionDialog()}return c.createElement("div",{ref:function(e){e&&(n.el=e)},className:"cp-multi-selector"},c.createElement("input",{type:"input",className:"cp-multi-selector__hidden-input",onFocus:this.displayDialog}),c.createElement("div",{onClick:this.displayDialog,className:"cp-multi-selector__main-input cps-form-control"},s),i)}});window&&!window.MultiSelector&&(window.MultiSelector=p),e.exports=p},function(e,t,s){e.exports=React},function(e,t,s){e.exports=_}]);