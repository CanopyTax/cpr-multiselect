/*!
 * cpr-multiselect
 * author: Bret Little
 * copyright: 2015
 * license: MIT
 * version: 2.0.3
 */
!function(e){function t(s){if(i[s])return i[s].exports;var l=i[s]={exports:{},id:s,loaded:!1};return e[s].call(l.exports,l,l.exports,t),l.loaded=!0,l.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}function l(e,t){for(var i,s=!0;s;){var l=e,a=t;if(s=!1,!l)return!1;if(i=l.className.indexOf(a)>-1)return i;e=l.parentElement,t=a,s=!0}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(1),n=s(a),r=i(2),c=n["default"].createClass({displayName:"DefaultItemComponent",render:function(){var e=this.props.item.firstName,t=this.props.item.lastName;return n["default"].createElement("div",null,n["default"].createElement("div",{className:"cp-multi-selector-item__icon cps-bg-medium-gray cps-gray-5"},""+e[0]+t[0]),n["default"].createElement("div",{className:"cp-multi-selector-item__title"},e+" "+t),n["default"].createElement("div",{className:"cp-multi-selector-item__check"},n["default"].createElement("i",{className:"cps-icon cps-icon-lg-check cps-info"})))}}),o=n["default"].createClass({displayName:"MultiSelector",componentWillMount:function(){document.body.addEventListener("click",this.state.close)},componentWillUnmount:function(){document.body.removeEventListener("click",this.state.close)},getInitialState:function(){var e=this;return{selectedItems:this.props.initialSelectedItems||[],dialogDisplayed:!1,activeIndex:null,searchValue:"",close:function(t){l(t.target,"cp-multi-selector")||e.setState({dialogDisplayed:!1})}}},displayDialog:function(e){this.setState({dialogDisplayed:!0})},removeItem:function(e,t){this.setState({selectedItems:r.without(this.state.selectedItems,e)}),setTimeout(this.triggerItemChange)},getItemTitle:function(e){return e.firstName+" "+e.lastName},keyUp:function(e){var t=e.which,i=this.state.activeIndex,s=this.getFilterItems(this.props.items);if(this.props.onInputChange&&this.props.onInputChange(e.currentTarget.value),40===t){if(r.isNull(i))return this.setState({activeIndex:0});if(i<s.length-1)return this.setState({activeIndex:i+1})}else if(38===t){if(!i)return this.setState({activeIndex:0});if(i>0)return this.setState({activeIndex:i-1})}else if(13===t){if(!r.isNull(i))return this.selectItem(s[i]);this.props.noRestrict&&(this.selectItem(e.currentTarget.value),e.currentTarget.value="")}else if(27===t)return this.setState({activeIndex:null,dialogDisplayed:!1});this.setState({searchValue:e.target.value})},triggerItemChange:function(){this.props.onChange&&this.props.onChange.call(null,this.state.selectedItems)},getSelectedClass:function(e){return r.contains(this.state.selectedItems,e)?"+selected":""},getActiveClass:function(e){return this.state.activeIndex===e?"+highlighted":""},getFilterItems:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],i=this.props.getItemTitle||this.getItemTitle;return t.filter(function(t){return i(t).toLowerCase().indexOf(e.state.searchValue.toLowerCase())>-1}).filter(function(e,t){return 4>t})},getSearchItems:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],i=this.props.ItemComponent||c;return this.getFilterItems(t).map(function(t,s){return n["default"].createElement("div",{key:s,className:"cp-multi-selector-item "+e.getSelectedClass(t)+" "+e.getActiveClass(s),onClick:e.selectItem.bind(e,t)},n["default"].createElement(i,{item:t}))})},selectItem:function(e,t){var i=this.state.selectedItems;r.contains(i,e)?this.setState({selectedItems:r.without(i,e)}):this.setState({selectedItems:r.union(i,[e])}),setTimeout(this.triggerItemChange)},positionDialog:function(){var e=this;setTimeout(function(){var t=n["default"].findDOMNode(e),i=t.clientHeight,s=t.querySelector(".cp-multi-selector__dialog");s.style.top=i+1+"px",t.querySelector(".cp-multi-selector__dialog__input").focus()},100)},prevent:function(e){13===e.which&&e.preventDefault()},render:function(){var e=this,t=this.props.getItemTitle||this.getItemTitle,i=this.state.selectedItems.map(function(i,s){return n["default"].createElement("div",{key:s,className:"cp-multi-selector__pill cps-white cps-bg-gray-10"},n["default"].createElement("span",{style:{verticalAlign:"top"}},t(i)),n["default"].createElement("i",{onClick:e.removeItem.bind(e,i),className:"cps-icon cps-icon-sm-close"}))}),s=void 0;if(this.state.dialogDisplayed){var l=this.props.placeholder?this.props.placeholder:"Type a collaborators name...";s=n["default"].createElement("div",{className:"cp-multi-selector__dialog depth-z2",style:{}},n["default"].createElement("input",{onKeyUp:this.keyUp,className:"cps-form-control cp-multi-selector__dialog__input",placeholder:l,onKeyDown:this.prevent}),n["default"].createElement("div",{className:"cp-multi-selector__dialog__items"},this.getSearchItems(this.props.items))),this.positionDialog()}return n["default"].createElement("div",{className:"cp-multi-selector"},n["default"].createElement("input",{type:"input",className:"cp-multi-selector__hidden-input",onFocus:this.displayDialog}),n["default"].createElement("div",{onClick:this.displayDialog,className:"cp-multi-selector__main-input cps-form-control"},i),s)}});window&&!window.MultiSelector&&(window.MultiSelector=o),t["default"]=o,e.exports=t["default"]},function(e,t,i){e.exports=React},function(e,t,i){e.exports=_}]);